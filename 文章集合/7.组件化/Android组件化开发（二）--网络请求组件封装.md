> ğŸ”¥ **Hiï¼Œæˆ‘æ˜¯å°ä½™ã€‚**
>
> **æœ¬æ–‡å·²æ”¶å½•åˆ° [GitHub Â· Androider-Planet](https://github.com/ByteYuhb/Androider-Planet) ä¸­ã€‚è¿™é‡Œæœ‰ Android è¿›é˜¶æˆé•¿çŸ¥è¯†ä½“ç³»ï¼Œå…³æ³¨å…¬ä¼—å· [[å°ä½™çš„è‡ªä¹ å®¤](https://mp.weixin.qq.com/s?__biz=MzkwODI1NDEwMA==&mid=2247483986&idx=1&sn=57136c9c062caa1026edf9ed35915c2b&chksm=c0cd8ca9f7ba05bfcfadad10bd97006bbb57afdd048c9c46fe57d122af834f569aa9d8df0e48&token=2142008574&lang=zh_CN#rd)] ï¼Œåœ¨æˆåŠŸçš„è·¯ä¸Šä¸è¿·è·¯ï¼**
### å‰è¨€

å‰é¢ä¸€ç¯‡æ–‡ç« æˆ‘ä»¬è®²è§£äº†`mavenç§æœ`çš„æ­å»ºï¼Œmavenç§æœåœ¨`ç»„ä»¶åŒ–æ¡†æ¶`ä¸­æœ‰ä¸€ä¸ªå¾ˆé‡è¦çš„åœ°ä½å°±æ˜¯å¯ä»¥å°†æˆ‘ä»¬çš„`lib`åº“æ”¾åˆ°å±€åŸŸç½‘ä¸­ï¼Œä¾›å…¬å¸å…¶ä»–å¼€å‘è€…ä½¿ç”¨ï¼Œå®ç°ç±»åº“çš„åˆ†äº«ã€‚

ä¸‹é¢æ˜¯è¿™ä¸ªç³»åˆ—å‡†å¤‡å®ç°çš„ä¸€ä¸ª`ç»„ä»¶åŒ–å®æˆ˜é¡¹ç›®æ¡†æ¶`ï¼š


![ç»„ä»¶åŒ–å¼€å‘.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/b6d92402648a440cbacfc3bbca66c3e3~tplv-k3u1fbpfcp-watermark.image?)

-   ç¬”è€…æ‰“ç®—`ä»ä¸‹å¾€ä¸Š`ä¾æ¬¡æ¥å®ç°æˆ‘ä»¬é¡¹ç›®ä¸­çš„ç»„ä»¶ï¼Œ**æ¯•ç«Ÿåœ°åŸºç¨³å›ºäº†ï¼Œæˆ¿å­æ‰å¯ä»¥æ­çš„å¾ˆç»“å®**ã€‚

`æ³¨æ„`ï¼šè¿™é‡Œä¸ä¼šå¯¹å°è£…ä»£ç è¿›è¡Œé•¿ç¯‡å¤§è®ºï¼Œä¸»è¦è¿˜æ˜¯ä»¥`æ€è·¯ç‚¹æ‹¨`çš„æ–¹å¼è¿›è¡Œï¼Œå¦‚æœéœ€è¦çœ‹å®Œæ•´ä»£ç çš„å¯ä»¥ç§»æ­¥åˆ°githubã€‚

[GitHub - ByteYuhb/anna_music_app](https://github.com/ByteYuhb/anna_music_app)

-   è¿™ç¯‡æ–‡ç« å®ç°çš„æ˜¯`ä¸€ä¸ªlib_network`åº“ï¼š

å®ç°ä¸€ä¸ªç»„ä»¶çš„å°è£…å‰ï¼Œæˆ‘ä»¬æœ‰å‡ ä¸ªæ­¥éª¤ï¼Œè¿™å‡ ä¸ªæ­¥éª¤ä¸å¯æˆ–ç¼ºï¼Œå¦‚æœä¸Šæ¥å°±ç›´æ¥ç ä»£ç ï¼Œæœ€åä¼šè®©ä½ ä»`æ¿€æƒ…åˆ°æ”¾å¼ƒ`çš„

-   **1.å…ˆåˆ†æéœ€æ±‚**

    -   æ¯ä¸ªç±»çš„å°è£…éƒ½æ˜¯æœ‰äº†æ–°çš„éœ€æ±‚ä¸€æ­¥ä¸€æ­¥å®ç°æ‰©å¤§çš„ï¼Œä¸å¯èƒ½ä¸€è¹´è€Œå°±ï¼ŒåŒ…æ‹¬ç¬”è€…ä»Šå¤©è®²è§£çš„`lib_network`ç±»åº“ï¼ŒåæœŸä¹Ÿä¼šæ ¹æ®ç”¨æˆ·éœ€æ±‚ä¸€æ­¥ä¸€æ­¥å£®å¤§ã€‚

        æ—¢ç„¶æ˜¯è¦å®ç°ä¸€ä¸ªç½‘ç»œè¯·æ±‚çš„å°è£…åº“ï¼šä¸»è¦åŒ…æ‹¬`get`,`post`ï¼Œ`formè¡¨å•`è¯·æ±‚ï¼Œ`æ–‡ä»¶ä¸Šä¼ å’Œä¸‹è½½`ç­‰ä¸€äº›åŸºç¡€ç½‘ç»œåŠŸèƒ½çš„å®ç°

-   2.æ ¹æ®éœ€æ±‚è¿›è¡Œ**æŠ€æœ¯é€‰å‹**

    -   æŠ€æœ¯é€‰å‹åœ¨ç±»åº“å°è£…ä¸­ä¹Ÿæ˜¯ä¸€ä¸ªé‡è¦æ­¥éª¤ï¼Œè¿™é‡Œæˆ‘ä»¬åªæ˜¯å®ç°ä¸€äº›ç½‘ç»œåŸºç¡€åŠŸèƒ½ï¼Œç¬”è€…æ‰“ç®—åœ¨`HttpUrlConnection`ï¼Œ`Volly`å’Œ`OkHttp`ä¸­é€‰æ‹©æˆ‘ä»¬æˆ‘ä»¬çš„å°è£…åŸºç¡€åº“

        

![1.æŠ€æœ¯é€‰å‹.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/3e77292039344945ab8438b8008339c3~tplv-k3u1fbpfcp-watermark.image?)

**å‡ ä¸ªå¾…é€‰å‹çš„æŠ€æœ¯å¯¹æ¯”ï¼š**

- `HttpUrlConnection`

è¿™ä¸ªç±»æ˜¯ä¸€ä¸ªæ¯”è¾ƒåº•å±‚çš„ç±»åº“äº†ï¼Œå¦‚æœä½¿ç”¨è¿™ä¸ªç±»åº“æ¥å°è£…ï¼Œæˆ‘ä»¬éœ€è¦å®ç°å¾ˆå¤šè½®å­å·¥ä½œï¼Œè€Œåœ¨å¦å¤–ä¸¤ä¸ªå¼€æºæ¡†æ¶`Volly`å’Œ`OkHttp`å·²ç»å®ç°äº†è¿™äº›å·¥ä½œï¼Œæ²¡å¿…è¦é‡å¤é€ è½®å­ï¼Œåœ¨è¿™é‡Œä¸è€ƒè™‘ã€‚

å¦‚æœæ‚¨å¯¹åº“æœ‰æ›´æ·±å±‚æ¬¡çš„è¦æ±‚ä¸”å¯¹è‡ªå·±æŠ€æœ¯æ¯”è¾ƒè‡ªä¿¡ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨è¿™ä¸ªç±»åº“å»å°è£…å®ç°ï¼Œæ¯•ç«Ÿå¼€æºåº“ä¹Ÿæ˜¯åœ¨è¿™äº›åŸºç¡€åº“ä¸Šå®ç°çš„ã€‚

- `Volly`

è¿™ä¸ªç±»åº“æ˜¯åœ¨`HttpUrlConnection` åŸºç¡€ä¸Šåšçš„ä¸€å±‚å°è£…ï¼Œä¸ºäº†å‡å°‘ç”¨æˆ·ä½¿ç”¨HttpUrlConnectionçš„å¤æ‚åº¦ã€‚

 ä¸€å¼€å§‹å‡ºæ¥æ˜¯googleä¸»æ¨çš„ç½‘ç»œè¯·æ±‚æ¡†æ¶ï¼Œgoogleå¸Œæœ›ç»Ÿä¸€Androidç½‘è·¯è¯·æ±‚åº“æ¨å‡ºçš„ä¸€ä¸ªæ¡†æ¶ã€‚é‚£ä¸ºä»€ä¹ˆåé¢ç”¨çš„äººè¶Šæ¥è¶Šå°‘äº†å‘¢ã€‚é‚£å°±æ˜¯å› ä¸ºä¸‹é¢æˆ‘ä»¬è¦è¯´çš„`OkHttp`æ¡†æ¶ã€‚

- `OkHttp`

çœ‹è¿‡æºç çš„éƒ½çŸ¥é“ï¼Œ`OkHttp`ä¹Ÿæ˜¯åœ¨`HttpUrlConnecttion`ä¸Šåšçš„å°è£…ï¼Œå…¶ç»§æ‰¿äº†`Volly`çš„ä¼˜åŠ¿ï¼Œä¸”åœ¨`Volly`ä¸Šæ„å»ºäº†è‡ªå·±çš„æœ‰ä¼˜ç‚¹ï¼ŒåŒ…æ‹¬ï¼š`è¿æ¥æ± å¤ç”¨`ï¼Œ`é‡è¯•é‡å®šå‘æœºåˆ¶`ï¼Œ`æ‹¦æˆªå™¨æ¨¡å¼`ç­‰ã€

å…·ä½“å…³äº`OkHttp`çš„ä»‹ç»å¯ä»¥å‚è€ƒæˆ‘çš„å¦å¤–ä¸€ç¯‡æ–‡ç« ï¼š

[Androidä½“ç³»è¯¾ ä¹‹ OkHttpä½ æƒ³çŸ¥é“çš„éƒ½åœ¨è¿™é‡Œäº†--](https://juejin.cn/post/7105013511784235016)

**ç¬”è€…æœ€åé€‰æ‹©ä½¿ç”¨`OkHttp`æ¥åšæˆ‘ä»¬åŸºç¡€åº“çš„å°è£…å·¥ä½œ**

<!---->

- **3.å°è£…æ€è·¯**

    å‰é¢é€šè¿‡å¯¹`å…·ä½“éœ€æ±‚åˆ†æ`ï¼Œå¹¶ä¸”ä¹Ÿåšäº†`æŠ€æœ¯é€‰å‹`

**æ¥ä¸‹æ¥å°±æ˜¯æ€ä¹ˆå»å®ç°è¿™ä¸ªå°è£…ï¼Ÿéœ€è¦å°è£…å“ªäº›ç±»ï¼Ÿ**

`æˆ‘ä»¬æ¥å›å¿†ä¸‹ä½¿ç”¨OkHttpçš„æ–¹å¼ï¼š`

```
fun testOkHttp(){
    val client = OkHttpClient()
    val r1:RequestBody = formBodyBuilder.build()
    val request = Request.Builder().get().url("http://host:port/api").build()
    val response = client.newCall(request).execute()
    print(response.body()?.bytes())
}
```

ç¬”è€…æ€è·¯ï¼š**é¦–å…ˆå°è£…çš„æ˜¯å’Œç”¨æˆ·`ç›´æ¥æ‰“äº¤é“`çš„ç±»**ï¼š

`Request`ï¼Œ`Response`å’Œ`OkHttpClient`ä»¥åŠå¼‚æ­¥æƒ…å†µä¸‹çš„`Callback`æ˜¯ç›´æ¥å’Œç”¨æˆ·æ‰“äº¤é“çš„åœ°æ–¹ï¼Œé‚£æˆ‘ä»¬å°±ä»è¿™å‡ ä¸ªç±»ä¸‹æ‰‹ä¾æ¬¡å¯¹å…¶è¿›è¡Œå°è£…ï¼š

`æˆ‘ä»¬å…ˆåˆ—å‡ºæ¥æˆ‘ä»¬æŠ€æœ¯æ–¹æ¡ˆï¼š`


![2.å°è£…æ€è·¯.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/cf2bef643ff741339a8f73db5a550754~tplv-k3u1fbpfcp-watermark.image?)

æœ‰äº†ä¸Šé¢å‡ ä¸ªåˆ†ææ­¥éª¤:æ¥ä¸‹æ¥æˆ‘ä»¬å°±æ¥å®ç°å…·ä½“çš„å°è£…æµç¨‹ï¼š

-   1.`Request`è¯·æ±‚çš„å°è£… **Request**ï¼šç”¨æˆ·è¯·æ±‚ç±»ï¼Œåœ¨OkHttpä¸­å°è£…äº†æˆ‘ä»¬çš„ä¸šåŠ¡è¯·æ±‚ä¿¡æ¯

è¿™é‡Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ª**CommonRequest**ç±»æ¥å†æ¬¡å°è£…æˆ‘ä»¬çš„Request

ç¬”è€…åªåˆ—å‡ºäº†éƒ¨åˆ†ç±»çš„æ¡†æ¶ä»£ç ï¼šå®Œæ•´ä»£ç åœ¨githubä¸Š

```java
public class CommonRequest {
    /**åˆ›å»ºä¸€ä¸ªPostçš„è¯·æ±‚ï¼Œä¸åŒ…æ‹¬headers
     * @return
     */
    public static Request createPostRequest(String url, RequestParams params){
        return createPostRequest(url,params,null);
    }
    /**åˆ›å»ºä¸€ä¸ªPostçš„è¯·æ±‚ï¼ŒåŒ…æ‹¬headers
     * @param url
     * @param params bodyçš„å‚æ•°é›†åˆ
     * @param headers headerçš„å‚æ•°é›†åˆ
     * @return
     */
    public static Request createPostRequest(String url, RequestParams params, RequestParams headers){
        FormBody.Builder mFormBodyBuilder = new FormBody.Builder();
        if(params!=null){
            for(Map.Entry<String,String> entry:params.urlParams.entrySet()){
                mFormBodyBuilder.add(entry.getKey(),entry.getValue());
            }
        }
        Headers.Builder mHeadersBuilder = new Headers.Builder();
        if(headers!=null){
            for(Map.Entry<String,String> entry:headers.urlParams.entrySet()){
                mHeadersBuilder.add(entry.getKey(),entry.getValue());
            }
        }
        return new Request.Builder()
                .url(url)
                .headers(mHeadersBuilder.build())
                .post(mFormBodyBuilder.build())
                .build();
    }

    /**åˆ›å»ºä¸€ä¸ªä¸åŒ…å«headerçš„getè¯·æ±‚
     * @return
     */
    public static Request createGetRequest(String url,RequestParams params){
        return createGetRequest(url,params,null);
    }
    /**åˆ›å»ºä¸€ä¸ªGetçš„è¯·æ±‚ï¼ŒåŒ…æ‹¬headers
     * @return
     */
    public static Request createGetRequest(String url,RequestParams params,RequestParams headers){
        StringBuilder stringBuilder = new StringBuilder(url).append("?");
        if(params != null){
            for(Map.Entry<String,String> entry:params.urlParams.entrySet()){
                stringBuilder.append(entry.getKey()).append("=").append(entry.getValue());
            }
        }
        Headers.Builder mHeadersBuilder = new Headers.Builder();
        if(headers!=null){
            for(Map.Entry<String,String> entry:headers.urlParams.entrySet()){
                mHeadersBuilder.add(entry.getKey(),entry.getValue());
            }
        }
        return new Request.Builder()
                .url(stringBuilder.toString())
                .headers(mHeadersBuilder.build())
                .get()
                .build();
    }
    private static final MediaType FILE_TYPE = MediaType.parse("application/octet-stream");

    /**æ–‡ä»¶ä¸Šä¼ è¯·æ±‚
     * @return
     */
    public static Request createMultiPostRequest(String url,RequestParams params){
        MultipartBody.Builder requestBuilder = new MultipartBody.Builder();
        requestBuilder.setType(MultipartBody.FORM);
        if(params != null){
            for (Map.Entry<String, Object> entry : params.fileParams.entrySet()) {
                if (entry.getValue() instanceof File) {
                    requestBuilder.addPart(Headers.of("Content-Disposition","form-data; name="" + entry.getKey() + """),
                            RequestBody.create(FILE_TYPE, (File) entry.getValue()));
                }else if (entry.getValue() instanceof String) {
                    requestBuilder.addPart(Headers.of("Content-Disposition", "form-data; name="" + entry.getKey() + """),
                            RequestBody.create(null, (String) entry.getValue()));
                }
            }
        }
        return new Request.Builder().url(url).post(requestBuilder.build()).build();
    }

    /**æ–‡ä»¶ä¸‹è½½è¯·æ±‚
     * @param url
     * @return
     */
    public static Request createFileDownLoadRequest(String url,RequestParams params){
        return createGetRequest(url,params);
    }
    /**æ–‡ä»¶ä¸‹è½½è¯·æ±‚
     * @param url
     * @return
     */
    public static Request createFileDownLoadRequest(String url){
        return createGetRequest(url,null);
    }
}
```

å¯ä»¥çœ‹åˆ°æˆ‘ä»¬åœ¨è¿™ä¸ªç±»é‡Œé¢åˆ›å»ºäº†å‡ ä¸ªæ–¹æ³•ï¼š

-   1.`Getè¯·æ±‚`
-   2.`Postè¯·æ±‚`
-   3.`æ–‡ä»¶ä¸Šä¼ `
-   4.`æ–‡ä»¶ä¸‹è½½`

è¿™å‡ ä¸ªè¯·æ±‚ï¼Œå·²ç»å¯ä»¥åŸºæœ¬æ»¡è¶³æˆ‘ä»¬å®æˆ˜é¡¹ç›®çš„è¦æ±‚äº†

-   2.  `response`å“åº”çš„å°è£…

ç”±äºresponseè¯·æ±‚æ˜¯åœ¨CallBackä¸­è¿”å›çš„ï¼Œæ€è·¯å°±æ˜¯ï¼Œè‡ªå®šä¹‰ä¸šåŠ¡å±‚éœ€è¦çš„CallBackï¼Œå°½é‡è®©ä»£ç è½»é‡åŒ–

è¿™é‡Œåˆ›å»ºäº†ä¸¤ä¸ª`CallBack`ç±»ï¼š

- 1.`CommonFileResponse`


è¿™ä¸ªç±»ä¸»è¦æ˜¯ç”±æ¥å¯¹`æ–‡ä»¶ç±»å‹`çš„è¯·æ±‚å›è°ƒè¿›è¡Œå°è£…:

**CommonFileResponse**å°è£…æ€è·¯ï¼š

- 1.å¯¹å¤±è´¥ç›¸åº”ç›´æ¥é€šè¿‡ä¸šåŠ¡å±‚ä¼ é€’ä¸‹æ¥çš„Listenerå›è°ƒç»™ä¸šåŠ¡å±‚å¤±è´¥ç»“æœ

- 2.å¯¹æˆåŠŸçš„ç›¸åº”ï¼Œæˆ‘ä»¬å…ˆå°†è¾“å…¥æµä¸­çš„æ•°æ®å†™å…¥åˆ°æ–‡ä»¶ä¸­ï¼Œå¹¶åœ¨ä¸»çº¿ç¨‹ä¸­å›è°ƒæ–‡ä»¶ä¸‹è½½è¿›åº¦ç»™ä¸šåŠ¡å±‚ã€‚ä¸šåŠ¡å±‚å¯ä»¥åœ¨è·å–æ–‡ä»¶ç»“æœçš„åŒæ—¶ï¼Œä¹Ÿå¯ä»¥è·å–æ–‡ä»¶ä¸‹è½½è¿›åº¦ã€‚

```java
/**
 * ä¸“é—¨å¤„ç†æ–‡ä»¶çš„å›è°ƒ
 */
public class CommonFileCallBack implements Callback {
    /**
     * the java layer exception, do not same to the logic error
     */
    protected final int NETWORK_ERROR = -1; // the network relative error
    protected final int IO_ERROR = -2; // the JSON relative error
    protected final String EMPTY_MSG = "";
    /**
     * å°†å…¶å®ƒçº¿ç¨‹çš„æ•°æ®è½¬å‘åˆ°UIçº¿ç¨‹
     */
    private static final int PROGRESS_MESSAGE = 0x01;
    private Handler mDeliveryHandler;
    private DisposeDownloadListener mListener;
    private String mFilePath;
    private int mProgress;
    public CommonFileCallBack(DisposeDataHandle handle){
        this.mListener = (DisposeDownloadListener) handle.mListener;
        this.mFilePath = handle.mSource;
        this.mDeliveryHandler = new Handler(Looper.getMainLooper()){
            @Override
            public void handleMessage(@NonNull Message msg) {
                switch (msg.what) {
                    case PROGRESS_MESSAGE:
                        mListener.onProgress((int) msg.obj);
                        break;
                }
            }
        };
    }
    @Override
    public void onFailure(Call call, IOException e) {
        mDeliveryHandler.post(new Runnable() {
            @Override
            public void run() {
                mListener.onFailure(new OkHttpException(NETWORK_ERROR, e));
            }
        });
    }

    @Override
    public void onResponse(Call call, Response response) throws IOException {
        final File file = handleResponse(response);
        mDeliveryHandler.post(new Runnable() {
            @Override
            public void run() {
                if (file != null) {
                    mListener.onSuccess(file);
                } else {
                    mListener.onFailure(new OkHttpException(IO_ERROR, EMPTY_MSG));
                }
            }
        });
    }

    private File handleResponse(Response response) {
        ...
            while ((length = inputStream.read(buffer)) != -1) {
                fos.write(buffer, 0, length);
                currentLength += length;
                mProgress = (int) (currentLength / sumLength * 100);
                mDeliveryHandler.obtainMessage(PROGRESS_MESSAGE, mProgress).sendToTarget();
            }
            fos.flush();
        } catch (Exception e) {
            file = null;
        } finally {
            ...
        }
        return file;
    }

}
```

- 2.`CommonJsonResponse`


è¿™ä¸ªç±»ç”¨å¤„å’Œæˆ‘ä»¬çš„`Retrofit`ç±»ä¼¼ï¼Œå°†è¯·æ±‚è½¬æ¢ä¸ºæˆ‘ä»¬éœ€è¦çš„ç±»ï¼Œé€šè¿‡`Gson`æˆ–è€…`fastJson`ç­‰æ¡†æ¶å¤„ç†ï¼š

```java
/**
 * @author anna
 * @function ä¸“é—¨å¤„ç†JSONçš„å›è°ƒ
 */
public class CommonJsonCallback implements Callback {

    /**
     * the logic layer exception, may alter in different app
     */
    protected final String RESULT_CODE = "ecode"; // æœ‰è¿”å›åˆ™å¯¹äºhttpè¯·æ±‚æ¥è¯´æ˜¯æˆåŠŸçš„ï¼Œä½†è¿˜æœ‰å¯èƒ½æ˜¯ä¸šåŠ¡é€»è¾‘ä¸Šçš„é”™è¯¯
    protected final int RESULT_CODE_VALUE = 0;
    protected final String ERROR_MSG = "emsg";
    protected final String EMPTY_MSG = "";

    /**
     * the java layer exception, do not same to the logic error
     */
    protected final int NETWORK_ERROR = -1; // the network relative error
    protected final int JSON_ERROR = -2; // the JSON relative error
    protected final int OTHER_ERROR = -3; // the unknow error

    /**
     * å°†å…¶å®ƒçº¿ç¨‹çš„æ•°æ®è½¬å‘åˆ°UIçº¿ç¨‹
     */
    private Handler mDeliveryHandler;
    private DisposeDataListener mListener;
    private Class<?> mClass;

    public CommonJsonCallback(DisposeDataHandle handle) {
        this.mListener = handle.mListener;
        this.mClass = handle.mClass;
        this.mDeliveryHandler = new Handler(Looper.getMainLooper());
    }

    @Override
    public void onFailure(final Call call, final IOException ioexception) {
        /**
         * æ­¤æ—¶è¿˜åœ¨éUIçº¿ç¨‹ï¼Œå› æ­¤è¦è½¬å‘
         */
        mDeliveryHandler.post(new Runnable() {
            @Override
            public void run() {
                mListener.onFailure(new OkHttpException(NETWORK_ERROR, ioexception));
            }
        });
    }

    @Override
    public void onResponse(final Call call, final Response response) throws IOException {
        final String result = response.body().string();
        mDeliveryHandler.post(new Runnable() {
            @Override
            public void run() {
                handleResponse(result);
            }
        });
    }

    private void handleResponse(Object responseObj) {
        if (responseObj == null || responseObj.toString().trim().equals("")) {
            mListener.onFailure(new OkHttpException(NETWORK_ERROR, EMPTY_MSG));
            return;
        }

        try {
            /**
             * åè®®ç¡®å®šåçœ‹è¿™é‡Œå¦‚ä½•ä¿®æ”¹
             */
            JSONObject result = new JSONObject(responseObj.toString());
            if (mClass == null) {
                mListener.onSuccess(result);
            } else {
                Object obj = new Gson().fromJson(responseObj.toString(), mClass);
                if (obj != null) {
                    mListener.onSuccess(obj);
                } else {
                    mListener.onFailure(new OkHttpException(JSON_ERROR, EMPTY_MSG));
                }
            }
        } catch (Exception e) {
            mListener.onFailure(new OkHttpException(OTHER_ERROR, e.getMessage()));
            e.printStackTrace();
        }
    }
}
```


- 3.  `OkHttpClient`è¯·æ±‚çš„å°è£…

`OkHttpClient`æ˜¯æˆ‘ä»¬`OkHttp`çš„æ ¸å¿ƒæ¢çº½ï¼Œä¸šåŠ¡å±‚ä»¥åŠæ ¸å¿ƒæ¡†æ¶å±‚éƒ½éœ€è¦ä½¿ç”¨åˆ°è¿™ä¸ªç±»ï¼Œæˆ‘ä»¬æ¥æ€è€ƒä¸‹æ€ä¹ˆå»å°è£…è¿™ä¸ªç±»ï¼š

1.æˆ‘ä»¬ä½¿ç”¨è£…é¥°å™¨æ¨¡å¼ï¼šåœ¨`CommonOkHttpClient`ä¸­å°è£…ä¸€ä¸ª`OkHttpClient`å¯¹è±¡ï¼Œé€šè¿‡`CommonOkHttpClient`å»ä»£ç†è¿™ä¸ª`OkHttpClient`å¯¹è±¡

æ¥çœ‹ä¸‹æˆ‘ä»¬å°è£…çš„ä»£ç :

```
public class CommonOkHttpClient {
    private static final int TIME_OUT = 30;
    private static OkHttpClient mOkHttpClient;
    static {
        OkHttpClient.Builder mOkHttpClientBuilder = new OkHttpClient.Builder();
        mOkHttpClientBuilder.hostnameVerifier(new HostnameVerifier() {
            @Override
            public boolean verify(String hostname, SSLSession session) {
                return true;
            }
        });
        //æ·»åŠ è‡ªå®šä¹‰çš„æ‹¦æˆªå™¨
        mOkHttpClientBuilder.addInterceptor(new Interceptor() {
            @Override
            public Response intercept(Chain chain) throws IOException {
                Request request = chain.request()
                        .newBuilder()
                        .addHeader("User-Agent","anna-movie")
                        .build();
                return chain.proceed(request);
            }
        });
        mOkHttpClientBuilder.cookieJar(new SimpleCookieJar());
        mOkHttpClientBuilder.connectTimeout(TIME_OUT, TimeUnit.SECONDS);
        mOkHttpClientBuilder.readTimeout(TIME_OUT, TimeUnit.SECONDS);
        mOkHttpClientBuilder.writeTimeout(TIME_OUT, TimeUnit.SECONDS);
        //è®¾ç½®æ˜¯å¦æ”¯æŒé‡å®šå‘
        mOkHttpClientBuilder.followRedirects(true);
        //è®¾ç½®ä»£ç†
       // mOkHttpClientBuilder.proxy()
        mOkHttpClientBuilder.sslSocketFactory(HttpsUtils.initSSLSocketFactory(),
                HttpsUtils.initTrustManager());
        mOkHttpClient = mOkHttpClientBuilder.build();
    }
    public static OkHttpClient getOkHttpClient() {
        return mOkHttpClient;
    }

    /**
     * é€šè¿‡æ„é€ å¥½çš„Request,Callbackå»å‘é€è¯·æ±‚
     */
    public static Call get(Request request, DisposeDataHandle handle) {
        Call call = mOkHttpClient.newCall(request);
        call.enqueue(new CommonJsonCallback(handle));
        return call;
    }
    public static Call post(Request request, DisposeDataHandle handle) {
        Call call = mOkHttpClient.newCall(request);
        call.enqueue(new CommonJsonCallback(handle));
        return call;
    }

    public static Call downloadFile(Request request, DisposeDataHandle handle) {
        Call call = mOkHttpClient.newCall(request);
        call.enqueue(new CommonFileCallBack(handle));
        return call;
    }
}
```

è¿™é‡Œé¢å°è£…äº†ä¸€ä¸ª`get`ï¼Œ`post`ï¼Œä»¥åŠ`æ–‡ä»¶ä¸‹è½½`çš„è¯·æ±‚:

å¯¹äºä¸šåŠ¡å±‚åªéœ€è¦è°ƒç”¨ï¼š

```
CommonOkHttpClient.get(...)
CommonOkHttpClient.post(...)
CommonOkHttpClient.downloadFile(..)
```

### æ€»ç»“ï¼š

æœ¬ç¯‡æ–‡ç« ä¸»è¦ä»¥å°è£…æ€è·¯çš„æ–¹å¼è¿›è¡Œè®²è§£ï¼Œå…·ä½“ä»£ç å¯ä»¥ç§»æ­¥åˆ°github

[GitHub - ByteYuhb/anna_music_app](https://github.com/ByteYuhb/anna_music_app)

å¯¹äºå¤§éƒ¨åˆ†ç±»åº“çš„å°è£…éƒ½å¯ä»¥ä½¿ç”¨æˆ‘ä»¬ä¸Šé¢çš„æ€è·¯ï¼Œå†ç»“åˆ`mavenç§æœ`çš„ä½¿ç”¨ã€‚å¯ä»¥å¾ˆå¥½çš„å°†æˆ‘ä»¬ä»£ç ä½œä¸ºä¸€ä¸ªç»„ä»¶å…±äº«ç»™å¼€å‘åŒäº‹ä½¿ç”¨

**ç»„ä»¶åŒ–é“è·¯é•¿è¿œ,è¿™é‡Œæˆ‘ä»¬åªæ˜¯å°è£…äº†ä¸€ä¸ªç½‘ç»œè¯·æ±‚åº“ï¼Œåé¢ä¼šä¸å®šæœŸå¯¹å…¶ä»–ç±»åº“è¿›è¡Œå°è£…ï¼Œæœ€åæ•´åˆæˆä¸€ä¸ªå®Œæ•´çš„ç»„ä»¶åŒ–æ¡†æ¶**

![ç»„ä»¶åŒ–å¼€å‘.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/5a06bdcf1a9b44e9863eafc1c63d11da~tplv-k3u1fbpfcp-watermark.image?)