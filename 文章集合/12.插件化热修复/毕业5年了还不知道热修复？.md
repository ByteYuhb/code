---
theme: smartblue
highlight: a11y-light
---
æˆ‘æŠ¥åå‚åŠ é‡‘çŸ³è®¡åˆ’1æœŸæŒ‘æˆ˜â€”â€”ç“œåˆ†10ä¸‡å¥–æ± ï¼Œè¿™æ˜¯æˆ‘çš„ç¬¬1ç¯‡æ–‡ç« ï¼Œ[ç‚¹å‡»æŸ¥çœ‹æ´»åŠ¨è¯¦æƒ…](https://s.juejin.cn/ds/jooSN7t "https://s.juejin.cn/ds/jooSN7t")
> ğŸ”¥ **Hiï¼Œæˆ‘æ˜¯å°ä½™ã€‚**
>
> **æœ¬æ–‡å·²æ”¶å½•åˆ° [GitHub Â· Androider-Planet](https://github.com/ByteYuhb/Androider-Planet) ä¸­ã€‚è¿™é‡Œæœ‰ Android è¿›é˜¶æˆé•¿çŸ¥è¯†ä½“ç³»ï¼Œå…³æ³¨å…¬ä¼—å· [å°ä½™çš„è‡ªä¹ å®¤] ï¼Œåœ¨æˆåŠŸçš„è·¯ä¸Šä¸è¿·è·¯ï¼**
## å‰è¨€
`çƒ­ä¿®å¤`åˆ°ç°åœ¨2022å¹´å·²ç»ä¸æ˜¯ä¸€ä¸ªæ–°åè¯ï¼Œä½†æ˜¯ä½œä¸º**Androidå¼€å‘æ ¸å¿ƒæŠ€æœ¯æ ˆçš„ä¸€éƒ¨åˆ†**ï¼Œæˆ‘è¿™é‡Œè¿˜å¾—æ¥ä¸€æ¬¡å†·é¥­çƒ­ç‚’ã€‚

éšç€ç§»åŠ¨ç«¯ä¸šåŠ¡å¤æ‚ç¨‹åº¦çš„å¢åŠ ï¼Œä¼ ç»Ÿçš„ç‰ˆæœ¬æ›´æ–°æµç¨‹æ˜¾ç„¶æ— æ³•æ»¡è¶³ä¸šåŠ¡å’Œå¼€å‘è€…çš„éœ€æ±‚ï¼Œ
çƒ­ä¿®å¤æŠ€æœ¯çš„æ¨å‡ºåœ¨å¾ˆå¤§ç¨‹åº¦ä¸Šæ”¹å–„äº†è¿™ä¸€å±€é¢ã€‚å›½å†…å¤§éƒ¨åˆ†æˆç†Ÿçš„ä¸»æµ Appéƒ½æ‹¥æœ‰è‡ªå·±çš„çƒ­æ›´æ–°æŠ€æœ¯ï¼Œåƒæ‰‹æ·˜ã€æ”¯ä»˜å®ã€å¾®ä¿¡ã€QQã€é¥¿äº†ä¹ˆã€ç¾å›¢ç­‰ã€‚

å¯ä»¥è¯´ï¼Œ**ä¸€ä¸ªå¥½çš„çƒ­ä¿®å¤æŠ€æœ¯ï¼Œå°†ä¸ºä½ çš„ AppåŠ©åŠ›ç™¾å€ã€‚å¯¹äºæ¯ä¸€ä¸ªæƒ³åœ¨ Android å¼€å‘é¢†åŸŸæœ‰æ‰€é€ è¯£çš„å¼€å‘è€…ï¼ŒæŒæ¡çƒ­ä¿®å¤æŠ€æœ¯æ›´æ˜¯å¿…å¤‡çš„ç´ è´¨**ã€‚

`çƒ­ä¿®å¤`æ˜¯ Android å¤§å‚é¢è¯•ä¸­**é«˜é¢‘é¢è¯•çŸ¥è¯†ç‚¹**ï¼Œä¹Ÿæ˜¯æˆ‘ä»¬å¿…é¡»è¦æŒæ¡çš„çŸ¥è¯†ç‚¹ã€‚çƒ­ä¿®å¤æŠ€æœ¯ï¼Œå¯ä»¥çœ‹ä½œ Androidå¹³å°å‘å±•æˆç†Ÿè‡³ä¸€å®šé˜¶æ®µçš„å¿…ç„¶äº§ç‰©ã€‚
**Androidçƒ­ä¿®å¤äº†è§£å—ï¼Ÿä¿®å¤å“ªäº›ä¸œè¥¿ï¼Ÿ
å¸¸è§çƒ­ä¿®å¤æ¡†æ¶å¯¹æ¯”ä»¥åŠå„åŸç†åˆ†æï¼Ÿ**



## 1.ä»€ä¹ˆæ˜¯çƒ­ä¿®å¤
çƒ­ä¿®å¤è¯´ç™½äº†å°±æ˜¯ä¸å†ä½¿ç”¨ä¼ ç»Ÿçš„åº”ç”¨å•†åº—æ›´æ–°æˆ–è€…è‡ªæ›´æ–°æ–¹å¼ï¼Œ**ä½¿ç”¨è¡¥ä¸åŒ…æ¨é€çš„æ–¹å¼åœ¨ç”¨æˆ·æ— æ„ŸçŸ¥çš„æƒ…å†µä¸‹ï¼Œä¿®å¤åº”ç”¨bugæˆ–è€…æ¨é€æ–°çš„éœ€æ±‚**

`ä¼ ç»Ÿæ›´æ–°`å’Œ`çƒ­æ›´æ–°`è¿‡ç¨‹å¯¹æ¯”å¦‚ä¸‹ï¼š

![çƒ­ä¿®å¤è¿‡ç¨‹å›¾.jpg](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/4c69e58b625546a5b0f6207c5ed85fab~tplv-k3u1fbpfcp-watermark.image?)



çƒ­ä¿®å¤`ä¼˜ç¼ºç‚¹`:

- **ä¼˜ç‚¹:**
    - 1.åªéœ€è¦æ‰“è¡¥ä¸åŒ…ï¼Œä¸éœ€è¦é‡æ–°å‘ç‰ˆæœ¬ã€‚
    - 2.ç”¨æˆ·æ— æ„ŸçŸ¥ï¼Œä¸éœ€è¦é‡æ–°ä¸‹è½½æœ€æ–°åº”ç”¨
    - 3.ä¿®å¤æˆåŠŸç‡é«˜
- **ç¼ºç‚¹**ï¼š
    - è¡¥ä¸åŒ…æ»¥ç”¨ï¼Œå®¹æ˜“å¯¼è‡´åº”ç”¨ç‰ˆæœ¬ä¸å¯æ§ï¼Œéœ€è¦å¼€å‘ä¸€å¥—å®Œæ•´çš„è¡¥ä¸åŒ…æ›´æ–°æœºåˆ¶ï¼Œä¼šå¢åŠ ä¸€å®šçš„æˆæœ¬



## 2.çƒ­ä¿®å¤æ–¹æ¡ˆ

é¦–å…ˆæˆ‘ä»¬å¾—çŸ¥é“çƒ­ä¿®å¤**ä¿®å¤å“ªäº›ä¸œè¥¿**ï¼Ÿ
- 1.**ä»£ç ä¿®å¤**
- 2.**èµ„æºä¿®å¤**
- 3.**åŠ¨æ€åº“ä¿®å¤**

### 2.1:ä»£ç ä¿®å¤æ–¹æ¡ˆ

ä»æŠ€æœ¯è§’åº¦æ¥è¯´ï¼Œæˆ‘ä»¬çš„ç›®çš„æ˜¯éå¸¸æ˜ç¡®çš„ï¼šæŠŠé”™è¯¯çš„ä»£ç æ›¿æ¢æˆæ­£ç¡®çš„ä»£ç ã€‚
æ³¨æ„è¿™é‡Œçš„æ›¿æ¢ï¼Œå¹¶ä¸æ˜¯ç›´æ¥æ“¦å†™dxæ–‡ä»¶ï¼Œè€Œæ˜¯æä¾›ä¸€ä»½æ–°çš„æ­£ç¡®ä»£ç ï¼Œè®©åº”ç”¨è¿è¡Œæ—¶ç»•è¿‡é”™è¯¯ä»£ç ï¼Œæ‰§è¡Œæ–°çš„æ­£ç¡®ä»£ç ã€‚

![çƒ­ä¿®å¤æ–¹æ³•è¿‡ç¨‹.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/7c41e2bbe7c54a3e900236f1ffb43459~tplv-k3u1fbpfcp-watermark.image?)

æƒ³æ³•ç®€å•ç›´æ¥ï¼Œä½†å®ç°èµ·æ¥å¹¶ä¸å®¹æ˜“ã€‚ç›®å‰ä¸»è¦æœ‰ä¸‰ç±»æŠ€æœ¯æ–¹æ¡ˆï¼š

#### 2.1.1.**ç±»åŠ è½½æ–¹æ¡ˆ**
ä¹‹å‰åˆ†æç±»åŠ è½½æœºåˆ¶æœ‰è¯´è¿‡:
**åŠ è½½æµç¨‹å…ˆæ˜¯éµå¾ªåŒäº²å§”æ´¾åŸåˆ™ï¼Œå¦‚æœå§”æ´¾åŸåˆ™æ²¡æœ‰æ‰¾åˆ°æ­¤å‰åŠ è½½è¿‡æ­¤ç±»ï¼Œ
åˆ™ä¼šè°ƒç”¨CLassLoaderçš„findClassæ–¹æ³•ï¼Œå†å»BaseDexClassLoaderä¸‹é¢çš„dexElementsæ•°ç»„ä¸­æŸ¥æ‰¾ï¼Œå¦‚æœæ²¡æœ‰æ‰¾åˆ°ï¼Œæœ€ç»ˆè°ƒç”¨defineClassNativeæ–¹æ³•åŠ è½½**

ä»£ç ä¿®å¤å°±æ˜¯åŸºäºè¿™ç‚¹ï¼š
**å°†æ–°çš„åšäº†ä¿®å¤çš„dexæ–‡ä»¶ï¼Œé€šè¿‡åå°„æ³¨å…¥åˆ°BaseDexClassLoaderçš„dexElementsæ•°ç»„çš„ç¬¬ä¸€ä¸ªä½ç½®ä¸ŠdexElements[0]ï¼Œä¸‹æ¬¡é‡æ–°å¯åŠ¨åº”ç”¨åŠ è½½ç±»çš„æ—¶å€™ï¼Œä¼šä¼˜å…ˆåŠ è½½åšäº†ä¿®å¤çš„dexæ–‡ä»¶ï¼Œè¿™æ ·å°±è¾¾åˆ°äº†ä¿®å¤ä»£ç çš„ç›®çš„**ã€‚åŸç†å¾ˆç®€å•

ä»£ç å¦‚ä¸‹ï¼š

```java
public class Hotfix {

    public static void patch(Context context, String patchDexFile, String patchClassName)
                    throws ClassNotFoundException, NoSuchFieldException, IllegalAccessException, InstantiationException, NoSuchMethodException, InvocationTargetException {
        //è·å–ç³»ç»ŸPathClassLoaderçš„"dexElements"å±æ€§å€¼
        PathClassLoader pathClassLoader = (PathClassLoader) context.getClassLoader();
        Object origDexElements = getDexElements(pathClassLoader);

        //æ–°å»ºDexClassLoaderå¹¶è·å–â€œdexElementsâ€å±æ€§å€¼
        String otpDir = context.getDir("dex", 0).getAbsolutePath();
        Log.i("hotfix", "otpdir=" + otpDir);
        DexClassLoader nDexClassLoader = new DexClassLoader(patchDexFile, otpDir, patchDexFile, context.getClassLoader());
        Object patchDexElements = getDexElements(nDexClassLoader);

        //å°†patchDexElementsæ’å…¥åŸorigDexElementså‰é¢
        Object allDexElements = combineArray(origDexElements, patchDexElements);

        //å°†æ–°çš„allDexElementsé‡æ–°è®¾ç½®å›pathClassLoader
        setDexElements(pathClassLoader, allDexElements);

        //é‡æ–°åŠ è½½ç±»
        pathClassLoader.loadClass(patchClassName);
}
private static Object getDexElements(ClassLoader classLoader) throws ClassNotFoundException, NoSuchFieldException, IllegalAccessException {
        //é¦–å…ˆè·å–ClassLoaderçš„â€œpathListâ€å®ä¾‹
        Field pathListField = Class.forName("dalvik.system.BaseDexClassLoader").getDeclaredField("pathList");
        pathListField.setAccessible(true);//è®¾ç½®ä¸ºå¯è®¿é—®
        Object pathList = pathListField.get(classLoader);

        //ç„¶åè·å–â€œpathListâ€å®ä¾‹çš„â€œdexElementsâ€å±æ€§
        Field dexElementField = pathList.getClass().getDeclaredField("dexElements");
        dexElementField.setAccessible(true);

        //è¯»å–"dexElements"çš„å€¼
        Object elements = dexElementField.get(pathList);
        return elements;
    }
    //åˆæ‹¼dexElements
    private static Object combineArray(Object obj, Object obj2) {
        Class componentType = obj2.getClass().getComponentType();
        //è¯»å–objé•¿åº¦
        int length = Array.getLength(obj);
        //è¯»å–obj2é•¿åº¦
        int length2 = Array.getLength(obj2);
        Log.i("hotfix", "length=" + length + ",length2=" + length2);
        //åˆ›å»ºä¸€ä¸ªæ–°Arrayå®ä¾‹ï¼Œé•¿åº¦ä¸ºojbå’Œobj2ä¹‹å’Œ
        Object newInstance = Array.newInstance(componentType, length + length2);
        for (int i = 0; i < length + length2; i++) {
                //æŠŠobj2å…ƒç´ æ’å…¥å‰é¢
                if (i < length2) {
                        Array.set(newInstance, i, Array.get(obj2, i));
                } else {
                        //æŠŠobjå…ƒç´ ä¾æ¬¡æ”¾åœ¨åé¢
                        Array.set(newInstance, i, Array.get(obj, i - length2));
                }
        }
        //è¿”å›æ–°çš„Arrayå®ä¾‹
        return newInstance;
    }
    private static void setDexElements(ClassLoader classLoader, Object dexElements) throws ClassNotFoundException, NoSuchFieldException, IllegalAccessException {
        //é¦–å…ˆè·å–ClassLoaderçš„â€œpathListâ€å®ä¾‹
        Field pathListField = Class.forName("dalvik.system.BaseDexClassLoader").getDeclaredField("pathList");
        pathListField.setAccessible(true);//è®¾ç½®ä¸ºå¯è®¿é—®
        Object pathList = pathListField.get(classLoader);

        //ç„¶åè·å–â€œpathListâ€å®ä¾‹çš„â€œdexElementsâ€å±æ€§
        Field declaredField = pathList.getClass().getDeclaredField("dexElements");
        declaredField.setAccessible(true);

        //è®¾ç½®"dexElements"çš„å€¼
        declaredField.set(pathList, dexElements);
    }
}

```

ç±»åŠ è½½è¿‡ç¨‹å¦‚ä¸‹ï¼š

![findclass.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/0acc2a77f1bc40448ef4aeda54176ab3~tplv-k3u1fbpfcp-watermark.image?)
å¾®ä¿¡`Tinker`ï¼ŒQQ ç©ºé—´çš„`è¶…çº§è¡¥ä¸`ã€æ‰‹ QQ çš„`QFix` ã€é¥¿äº† ä¹ˆçš„ `Amigo` å’Œ  `Nuwa` ç­‰éƒ½æ˜¯ä½¿ç”¨è¿™ä¸ªæ–¹å¼

**ç¼ºç‚¹**ï¼šå› ä¸ºç±»åŠ è½½åæ— æ³•å¸è½½ï¼Œæ‰€ä»¥ç±»åŠ è½½æ–¹æ¡ˆ**å¿…é¡»é‡å¯App**ï¼Œè®©bugç±»é‡æ–°åŠ è½½åæ‰èƒ½ç”Ÿæ•ˆã€‚

#### 2.1.2:åº•å±‚æ›¿æ¢æ–¹æ¡ˆ
åº•å±‚æ›¿æ¢æ–¹æ¡ˆä¸ä¼šå†æ¬¡åŠ è½½æ–°ç±»ï¼Œè€Œæ˜¯ç›´æ¥**åœ¨ Native å±‚ ä¿®æ”¹åŸæœ‰ç±»**ï¼Œ
è¿™é‡Œæˆ‘ä»¬éœ€è¦æåˆ°Artè™šæ‹Ÿæœºä¸­`ArtMethod`ï¼š
æ¯ä¸€ä¸ªJavaæ–¹æ³•åœ¨Artè™šæ‹Ÿæœºä¸­éƒ½å¯¹åº”ç€ä¸€ä¸ª` ArtMethod`ï¼Œ**ArtMethodè®°å½•äº†è¿™ä¸ªJavaæ–¹æ³•çš„æ‰€æœ‰ä¿¡æ¯ï¼ŒåŒ…æ‹¬æ‰€å±ç±»ã€è®¿é—®æƒé™ã€ä»£ç æ‰§è¡Œåœ°å€ç­‰**ã€‚

ç»“æ„å¦‚ä¸‹ï¼š

```java
// art/runtime/art_method.h
class ArtMethod FINAL {
...
 protected:
  GcRoot<mirror::Class> declaring_class_;
  GcRoot<mirror::PointerArray> dex_cache_resolved_methods_;
  GcRoot<mirror::ObjectArray<mirror::Class>> dex_cache_resolved_types_;
  uint32_t access_flags_;
  uint32_t dex_code_item_offset_;
  uint32_t dex_method_index_;
  uint32_t method_index_;

  struct PACKED(4) PtrSizedFields {
        void* entry_point_from_interpreter_;      // 1
        void* entry_point_from_jni_;
        void* entry_point_from_quick_compiled_code_;  //2
  } ptr_sized_fields_;
  ...
}
```
åœ¨ ArtMethodç»“æ„ä½“ä¸­ï¼Œæœ€é‡è¦çš„å°±æ˜¯ **æ³¨é‡Š1å’Œæ³¨é‡Š2æ ‡æ³¨çš„å†…å®¹**ï¼Œä»åå­—å¯ä»¥çœ‹å‡ºæ¥ï¼Œä»–ä»¬å°±æ˜¯æ–¹æ³•çš„æ‰§è¡Œå…¥å£ã€‚
æˆ‘ä»¬çŸ¥é“ï¼ŒJavaä»£ç åœ¨Androidä¸­ä¼šè¢«ç¼–è¯‘ä¸º **Dex Code**ã€‚	

Artè™šæ‹Ÿæœºä¸­å¯ä»¥é‡‡ç”¨**è§£é‡Šæ¨¡å¼**æˆ–è€… **AOTæœºå™¨ç æ¨¡**å¼æ‰§è¡Œ **Dex Code**

- **è§£é‡Šæ¨¡å¼:**
    å°±æ˜¯å»é™¤Dex Codeï¼Œé€æ¡è§£é‡Šæ‰§è¡Œã€‚
    å¦‚æœæ–¹æ³•çš„è°ƒç”¨è€…æ˜¯ä»¥è§£é‡Šæ¨¡å¼è¿è¡Œçš„ï¼Œåœ¨è°ƒç”¨è¿™ä¸ªæ–¹æ³•æ—¶ï¼Œå°±ä¼šè·å–è¿™ä¸ªæ–¹æ³•çš„ entry_point_from_interpreter_ï¼Œç„¶åè·³è½¬æ‰§è¡Œã€‚
- **AOTæ¨¡å¼:**
    å°±ä¼šé¢„å…ˆç¼–è¯‘å¥½ Dex Codeå¯¹åº”çš„æœºå™¨ç ï¼Œç„¶ååœ¨è¿è¡ŒæœŸç›´æ¥æ‰§è¡Œæœºå™¨ç ï¼Œä¸éœ€è¦é€æ¡è§£é‡Šæ‰§è¡ŒDex Codeã€‚
    å¦‚æœæ–¹æ³•çš„è°ƒç”¨è€…æ˜¯ä»¥AOTæœºå™¨ç æ–¹å¼æ‰§è¡Œçš„ï¼Œåœ¨è°ƒç”¨è¿™ä¸ªæ–¹æ³•æ—¶ï¼Œå°±æ˜¯è·³è½¬åˆ° entry_point_from_quick_compiled_code_ä¸­æ‰§è¡Œã€‚

> é‚£æ˜¯ä¸æ˜¯åªéœ€è¦æ›¿æ¢è¿™ä¸ªå‡ ä¸ª entry_point_* å…¥å£åœ°å€å°±èƒ½å¤Ÿå®ç°æ–¹æ³•æ›¿æ¢äº†å‘¢ï¼Ÿ
> **å¹¶æ²¡æœ‰é‚£ä¹ˆç®€å•ï¼Œå› ä¸ºä¸è®ºæ˜¯è§£é‡Šæ¨¡å¼è¿˜æ˜¯AOTæ¨¡å¼ï¼Œåœ¨è¿è¡ŒæœŸé—´è¿˜ä¼šéœ€è¦è°ƒç”¨ArtMethodä¸­çš„å…¶ä»–æˆå‘˜å­—æ®µ**

**AndFixé‡‡ç”¨çš„æ˜¯æ”¹å˜æŒ‡é’ˆæŒ‡å‘**ï¼š
```java
// AndFix/jni/art/art_method_replace_6_0.cpp
void replace_6_0(JNIEnv* env, jobject src, jobject dest) {
    art::mirror::ArtMethod* smeth =
                    (art::mirror::ArtMethod*) env->FromReflectedMethod(src);  // 1

    art::mirror::ArtMethod* dmeth =
                    (art::mirror::ArtMethod*) env->FromReflectedMethod(dest);  // 2
    ...
    // 3
    smeth->declaring_class_ = dmeth->declaring_class_;
    smeth->dex_cache_resolved_methods_ = dmeth->dex_cache_resolved_methods_;
    smeth->dex_cache_resolved_types_ = dmeth->dex_cache_resolved_types_;
    smeth->access_flags_ = dmeth->access_flags_ | 0x0001;
    smeth->dex_code_item_offset_ = dmeth->dex_code_item_offset_;
    smeth->dex_method_index_ = dmeth->dex_method_index_;
    smeth->method_index_ = dmeth->method_index_;

    smeth->ptr_sized_fields_.entry_point_from_interpreter_ =
    dmeth->ptr_sized_fields_.entry_point_from_interpreter_;

    smeth->ptr_sized_fields_.entry_point_from_jni_ =
    dmeth->ptr_sized_fields_.entry_point_from_jni_;
    smeth->ptr_sized_fields_.entry_point_from_quick_compiled_code_ =
    dmeth->ptr_sized_fields_.entry_point_from_quick_compiled_code_;

    LOGD("replace_6_0: %d , %d",
             smeth->ptr_sized_fields_.entry_point_from_quick_compiled_code_,
             dmeth->ptr_sized_fields_.entry_point_from_quick_compiled_code_);
}
```

**ç¼ºç‚¹**ï¼šå­˜åœ¨ä¸€äº›å…¼å®¹æ€§é—®é¢˜ï¼Œç”±äºArtMethodç»“æ„ä½“æ˜¯Androidå¼€æºçš„ä¸€éƒ¨åˆ†ï¼Œæ‰€ä»¥æ¯ä¸ªæ‰‹æœºå‚å•†éƒ½å¯èƒ½ä¼šå»æ›´æ”¹è¿™éƒ¨åˆ†çš„å†…å®¹ï¼Œè¿™å°±å¯èƒ½å¯¼è‡´ArtMethodæ›¿æ¢æ–¹æ¡ˆåœ¨æŸäº›æœºå‹ä¸Šé¢å‡ºç°æœªçŸ¥é”™è¯¯ã€‚

**Sophixä¸ºäº†è§„é¿ä¸Šé¢çš„AndFixçš„é£é™©ï¼Œé‡‡ç”¨ç›´æ¥`æ›¿æ¢æ•´ä¸ªç»“æ„ä½“`ã€‚è¿™æ ·ä¸ç®¡æ‰‹æœºå‚å•†å¦‚ä½•æ›´æ”¹ç³»ç»Ÿï¼Œæˆ‘ä»¬éƒ½å¯ä»¥æ­£ç¡®å®šä½åˆ°æ–¹æ³•åœ°å€**

#### 2.4.3:`install run`æ–¹æ¡ˆ
Instant Run æ–¹æ¡ˆçš„æ ¸å¿ƒæ€æƒ³æ˜¯â€”â€”**æ’æ¡©**ï¼Œ**åœ¨ç¼–è¯‘æ—¶é€šè¿‡æ’æ¡©åœ¨æ¯ä¸€ä¸ªæ–¹æ³•ä¸­æ’å…¥ä»£ç ï¼Œä¿®æ”¹ä»£ç é€»è¾‘ï¼Œåœ¨éœ€è¦æ—¶ç»•è¿‡é”™è¯¯æ–¹æ³•ï¼Œè°ƒç”¨patchç±»çš„æ­£ç¡®æ–¹æ³•ã€‚**

é¦–å…ˆï¼Œåœ¨ç¼–è¯‘æ—¶Instant Runä¸ºæ¯ä¸ªç±»æ’å…¥IncrementalChangeå˜é‡

```java
IncrementalChange  $change;
```
ä¸ºæ¯ä¸€ä¸ªæ–¹æ³•æ·»åŠ ç±»ä¼¼å¦‚ä¸‹ä»£ç ï¼š

```java
public void onCreate(Bundle savedInstanceState) {
    IncrementalChange var2 = $change;
    //$changeä¸ä¸ºnullï¼Œè¡¨ç¤ºè¯¥ç±»æœ‰ä¿®æ”¹ï¼Œéœ€è¦é‡å®šå‘
    if(var2 != null) {
        //é€šè¿‡access$dispatchæ–¹æ³•è·³è½¬åˆ°patchç±»çš„æ­£ç¡®æ–¹æ³•
        var2.access$dispatch("onCreate.(Landroid/os/Bundle;)V", new Object[]{this, savedInstanceState});
    } else {
        super.onCreate(savedInstanceState);
        this.setContentView(2130968601);
        this.tv = (TextView)this.findViewById(2131492944);
    }
}
```

å¦‚ä¸Šä»£ç ï¼Œå½“ä¸€ä¸ªç±»è¢«ä¿®æ”¹åï¼ŒInstant Runä¼šä¸ºè¿™ä¸ªç±»æ–°å»ºä¸€ä¸ªç±»ï¼Œå‘½åä¸ºxxx&overrideï¼Œä¸”å®ç°IncrementalChangeæ¥å£ï¼Œå¹¶ä¸”èµ‹å€¼ç»™åŸç±»çš„$changeå˜é‡ã€‚

```java
public class MainActivity$override implements IncrementalChange {
ï½
```
æ­¤æ—¶ï¼Œåœ¨è¿è¡Œæ—¶åŸç±»ä¸­æ¯ä¸ªæ–¹æ³•çš„var2 != nullï¼Œé€šè¿‡accessdispatchï¼ˆå‚æ•°æ˜¯æ–¹æ³•åå’ŒåŸå‚æ•°ï¼‰å®šä½åˆ°patchç±»MainActivitydispatchï¼ˆå‚æ•°æ˜¯æ–¹æ³•åå’ŒåŸå‚æ•°ï¼‰å®šä½åˆ°patchç±»MainActivityoverrideä¸­ä¿®æ”¹åçš„æ–¹æ³•ã€‚

**Instant Runæ˜¯googleåœ¨AS2.0æ—¶ç”¨æ¥å®ç°â€œçƒ­éƒ¨ç½²â€çš„ï¼ŒåŒæ—¶ä¹Ÿä¸ºâ€œçƒ­ä¿®å¤â€æä¾›äº†ä¸€ä¸ªç»ä½³çš„æ€è·¯ã€‚ç¾å›¢çš„Robustå°±æ˜¯åŸºäºæ­¤**ã€‚

### 2.2ï¼šèµ„æºä¿®å¤æ–¹æ¡ˆ
è¿™é‡Œæˆ‘ä»¬æ¥çœ‹çœ‹install runçš„åŸç†å³å¯ï¼Œå¸‚é¢ä¸Šçš„å¸¸è§ä¿®å¤æ–¹æ¡ˆå¤§éƒ¨åˆ†éƒ½æ˜¯åŸºäºæ­¤æ–¹æ³•ã€‚

```java
public static void monkeyPatchExistingResources(Context context,
            String externalResourceFile, Collection<Activity> activities) {
    if (externalResourceFile == null) {
            return;
    }
    try {
// åˆ›å»ºä¸€ä¸ªæ–°çš„AssetManager
        AssetManager newAssetManager = (AssetManager) AssetManager.class
                        .getConstructor(new Class[0]).newInstance(new Object[0]); // ... 1
        Method mAddAssetPath = AssetManager.class.getDeclaredMethod(
                        "addAssetPath", new Class[] { String.class }); // ... 2
        mAddAssetPath.setAccessible(true);
// é€šè¿‡åå°„è°ƒç”¨addAssetPathæ–¹æ³•åŠ è½½å¤–éƒ¨çš„èµ„æºï¼ˆSDå¡èµ„æºï¼‰
        if (((Integer) mAddAssetPath.invoke(newAssetManager,
                        new Object[] { externalResourceFile })).intValue() == 0) { // ... 3
                throw new IllegalStateException(
                                "Could not create new AssetManager");
        }
        Method mEnsureStringBlocks = AssetManager.class.getDeclaredMethod(
                        "ensureStringBlocks", new Class[0]);
        mEnsureStringBlocks.setAccessible(true);
        mEnsureStringBlocks.invoke(newAssetManager, new Object[0]);
        if (activities != null) {
            for (Activity activity : activities) {
                Resources resources = activity.getResources(); // ... 4
                try { 
// åå°„å¾—åˆ°Resourcesçš„AssetManagerç±»å‹çš„mAssetså­—æ®µ
                    Field mAssets = Resources.class
                                    .getDeclaredField("mAssets"); // ... 5
                    mAssets.setAccessible(true);
// å°†mAssetså­—æ®µçš„å¼•ç”¨æ›¿æ¢ä¸ºæ–°åˆ›å»ºçš„newAssetManager
                    mAssets.set(resources, newAssetManager); // ... 6
                } catch (Throwable ignore) {
                    ...
                }

// å¾—åˆ°Activityçš„Resources.Theme
                Resources.Theme theme = activity.getTheme();
                try {
                    try {
// åå°„å¾—åˆ°Resources.Themeçš„mAssetså­—æ®µ
                        Field ma = Resources.Theme.class
                                        .getDeclaredField("mAssets");
                        ma.setAccessible(true);
// å°†Resources.Themeçš„mAssetså­—æ®µçš„å¼•ç”¨æ›¿æ¢ä¸ºæ–°åˆ›å»ºçš„newAssetManager
                        ma.set(theme, newAssetManager); // ... 7
                    } catch (NoSuchFieldException ignore) {
                            ...
                    }
                        ...
                } catch (Throwable e) {
                    Log.e("InstantRun",
                                    "Failed to update existing theme for activity "
                                                    + activity, e);
                }
                pruneResourceCaches(resources);
        }
        }
/**
*  æ ¹æ®SDKç‰ˆæœ¬çš„ä¸åŒï¼Œç”¨ä¸åŒçš„æ–¹å¼å¾—åˆ°Resources çš„å¼±å¼•ç”¨é›†åˆ
*/ 
        Collection<WeakReference<Resources>> references;
        if (Build.VERSION.SDK_INT >= 19) {
            Class<?> resourcesManagerClass = Class
                            .forName("android.app.ResourcesManager");
            Method mGetInstance = resourcesManagerClass.getDeclaredMethod(
                            "getInstance", new Class[0]);
            mGetInstance.setAccessible(true);
            Object resourcesManager = mGetInstance.invoke(null,
                            new Object[0]);
            try {
                Field fMActiveResources = resourcesManagerClass
                                .getDeclaredField("mActiveResources");
                fMActiveResources.setAccessible(true);

                ArrayMap<?, WeakReference<Resources>> arrayMap = (ArrayMap) fMActiveResources
                                .get(resourcesManager);
                references = arrayMap.values();
            } catch (NoSuchFieldException ignore) {
                Field mResourceReferences = resourcesManagerClass
                                .getDeclaredField("mResourceReferences");
                mResourceReferences.setAccessible(true);

                references = (Collection) mResourceReferences
                                .get(resourcesManager);
            }
        } else {
            Class<?> activityThread = Class
                            .forName("android.app.ActivityThread");
            Field fMActiveResources = activityThread
                            .getDeclaredField("mActiveResources");
            fMActiveResources.setAccessible(true);
            Object thread = getActivityThread(context, activityThread);

            HashMap<?, WeakReference<Resources>> map = (HashMap) fMActiveResources
                            .get(thread);

            references = map.values();
        }
//éå†å¹¶å¾—åˆ°å¼±å¼•ç”¨é›†åˆä¸­çš„ Resources ï¼Œå°† Resources mAssets å­—æ®µå¼•ç”¨æ›¿æ¢æˆæ–°çš„ AssetManager
            for (WeakReference<Resources> wr : references) {
                Resources resources = (Resources) wr.get();
                if (resources != null) {
                    try {
                        Field mAssets = Resources.class
                                        .getDeclaredField("mAssets");
                        mAssets.setAccessible(true);
                        mAssets.set(resources, newAssetManager);
                    } catch (Throwable ignore) {
                        ...
                    }
                    resources.updateConfiguration(resources.getConfiguration(),
                                    resources.getDisplayMetrics());
                }
            }
    } catch (Throwable e) {
            throw new IllegalStateException(e);
    }
}
```


- åœ¨**æ³¨é‡Š1**å¤„åˆ›å»ºä¸€ä¸ªæ–°çš„ AssetManager ï¼Œ
- åœ¨**æ³¨é‡Š2** å’Œ**æ³¨é‡Š3** å¤„é€šè¿‡åå°„è°ƒç”¨ addAssetPath æ–¹æ³•åŠ è½½å¤–éƒ¨ï¼ˆ SD å¡ï¼‰çš„èµ„æºã€‚
- åœ¨**æ³¨é‡Š4** å¤„éå† Activity  åˆ—è¡¨ï¼Œå¾—åˆ°æ¯ä¸ª Activity çš„ Resources ï¼Œ
- åœ¨**æ³¨é‡Š5** å¤„é€šè¿‡åå°„å¾—åˆ° Resources çš„  AssetManager ç±»å‹çš„ rnAssets å­—æ®µ ï¼Œ
- **æ³¨é‡Š6**å¤„æ”¹å†™ mAssets å­—æ®µçš„å¼•ç”¨ä¸ºæ–°çš„ AssetManager ã€‚

**é‡‡ç”¨åŒæ ·çš„æ–¹å¼**ï¼Œ
- åœ¨**æ³¨é‡Š7**å¤„å°† Resources. Theme çš„ m Assets å­—æ®µ çš„å¼•ç”¨æ›¿æ¢ä¸ºæ–°åˆ›å»ºçš„ AssetManager ã€‚ 
- ç´§æ¥ç€ æ ¹æ® SDK ç‰ˆæœ¬çš„ä¸åŒï¼Œç”¨ä¸åŒçš„æ–¹å¼å¾—åˆ° Resources çš„å¼±å¼•ç”¨é›†åˆï¼Œ
- å†éå†è¿™ä¸ªå¼±å¼•ç”¨é›†åˆï¼Œ å°†å¼±å¼•ç”¨é›†åˆä¸­çš„ Resources çš„ mAssets å­—æ®µå¼•ç”¨éƒ½æ›¿æ¢æˆæ–°åˆ›å»ºçš„ AssetManager ã€‚

`èµ„æºä¿®å¤åŸç†`ï¼š
> - 1.åˆ›å»ºæ–°çš„AssetManagerï¼Œé€šè¿‡åå°„è°ƒç”¨addAssetPathæ–¹æ³•ï¼ŒåŠ è½½å¤–éƒ¨èµ„æºï¼Œè¿™æ ·æ–°åˆ›å»ºçš„AssetManagerå°±å«æœ‰äº†å¤–éƒ¨èµ„æº
> - 2.å°†AssetManagerç±»å‹çš„mAssetå­—æ®µå…¨éƒ¨ç”¨æ–°åˆ›å»ºçš„AssetManagerå¯¹è±¡æ›¿æ¢ã€‚è¿™æ ·ä¸‹æ¬¡åŠ è½½èµ„æºæ–‡ä»¶çš„æ—¶å€™å°±å¯ä»¥æ‰¾åˆ°åŒ…å«å¤–éƒ¨èµ„æºæ–‡ä»¶çš„AssetManagerã€‚

### 2.3ï¼šåŠ¨æ€é“¾æ¥åº“soçš„ä¿®å¤

#### 1.æ¥å£è°ƒç”¨æ›¿æ¢æ–¹æ¡ˆï¼š
sdkæä¾›æ¥å£æ›¿æ¢Systemé»˜è®¤åŠ è½½soåº“æ¥å£

```java
SOPatchManager.loadLibrary(String libName) -> System.loadLibrary(String libName)
```
SOPatchManager.loadLibraryæ¥å£åŠ è½½ soåº“çš„æ—¶å€™**ä¼˜å…ˆå°è¯•å»åŠ è½½sdk æŒ‡å®šç›®å½•ä¸‹çš„è¡¥ä¸so**ï¼Œ

`åŠ è½½ç­–ç•¥`å¦‚ä¸‹ï¼š

**å¦‚æœå­˜åœ¨åˆ™åŠ è½½è¡¥ä¸ soåº“è€Œä¸ä¼šå»åŠ è½½å®‰è£…apkå®‰è£…ç›®å½•ä¸‹çš„soåº“
å¦‚æœä¸å­˜åœ¨è¡¥ä¸soï¼Œé‚£ä¹ˆè°ƒç”¨System.loadLibraryå»åŠ è½½å®‰è£…apkç›®å½•ä¸‹çš„ soåº“ã€‚**

![åŠ è½½soåº“.jpg](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e4c5714c45fb48a68f18d85ef3075484~tplv-k3u1fbpfcp-watermark.image?)
æˆ‘ä»¬å¯ä»¥å¾ˆæ¸…æ¥šçš„çœ‹åˆ°è¿™ä¸ªæ–¹æ¡ˆçš„ä¼˜ç¼ºç‚¹:
ä¼˜ç‚¹ï¼šä¸éœ€è¦å¯¹ä¸åŒ sdk ç‰ˆæœ¬è¿›è¡Œå…¼å®¹ï¼Œå› ä¸ºæ‰€æœ‰çš„ sdk ç‰ˆæœ¬éƒ½æœ‰ System.loadLibrary è¿™ä¸ªæ¥å£ã€‚
ç¼ºç‚¹ï¼šè°ƒç”¨æ–¹éœ€è¦æ›¿æ¢æ‰ System é»˜è®¤åŠ è½½ so åº“æ¥å£ä¸º sdkæä¾›çš„æ¥å£ï¼Œ å¦‚æœæ˜¯å·²ç»ç¼–è¯‘æ··æ·†å¥½çš„ä¸‰æ–¹åº“çš„so åº“éœ€è¦ patchï¼Œé‚£ä¹ˆæ˜¯å¾ˆéš¾åšåˆ°æ¥å£çš„æ›¿æ¢

è™½ç„¶è¿™ç§æ–¹æ¡ˆå®ç°ç®€å•ï¼ŒåŒæ—¶ä¸éœ€è¦å¯¹ä¸åŒ sdkç‰ˆæœ¬åŒºåˆ†å¤„ç†ï¼Œä½†æ˜¯æœ‰ä¸€å®šçš„å±€é™æ€§æ²¡æ³•ä¿®å¤ä¸‰æ–¹åŒ…çš„soåº“åŒæ—¶éœ€è¦å¼ºåˆ¶ä¾µå…¥æ¥å…¥æ–¹æ¥å£è°ƒç”¨ï¼Œæ¥ç€æˆ‘ä»¬æ¥çœ‹ä¸‹åå°„æ³¨å…¥æ–¹æ¡ˆã€‚

#### 2ã€åå°„æ³¨å…¥æ–¹æ¡ˆ
**å‰é¢ä»‹ç»è¿‡ System. loadLibrary ( "native-lib"); åŠ è½½ soåº“çš„åŸç†ï¼Œå…¶å®native-lib è¿™ä¸ª so åº“æœ€ç»ˆä¼ ç»™ native æ–¹æ³•æ‰§è¡Œçš„å‚æ•°æ˜¯ soåº“åœ¨ç£ç›˜ä¸­çš„å®Œæ•´è·¯å¾„ï¼Œæ¯”å¦‚ï¼š/data/app-lib/com.taobao.jni-2/libnative-lib.so, soåº“ä¼šåœ¨ DexPathList.nativeLibraryDirectories/nativeLibraryPathElements å˜é‡æ‰€è¡¨ç¤ºçš„ç›®å½•ä¸‹å»éå†æœç´¢**

**sdk<23** DexPathList.findLibrary å®ç°å¦‚ä¸‹

![å°ä½™23.jpg](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/51cc98dd82934d5590ac59b514eb43ed~tplv-k3u1fbpfcp-watermark.image?)

å¯ä»¥å‘ç°ä¼šéå† nativeLibraryDirectoriesæ•°ç»„ï¼Œå¦‚æœæ‰¾åˆ°äº† loUtils.canOpenReadOnly (path)è¿”å›ä¸º true, é‚£ä¹ˆå°±ç›´æ¥è¿”å›è¯¥ path, loUtils.canOpenReadOnly (path)è¿”å›ä¸º true çš„å‰æè‚¯å®šæ˜¯éœ€è¦ path è¡¨ç¤ºçš„ soæ–‡ä»¶å­˜ åœ¨çš„ã€‚é‚£ä¹ˆæˆ‘ä»¬å¯ä»¥é‡‡å–ç±»ä¼¼ç±»ä¿®å¤åå°„æ³¨å…¥æ–¹å¼ï¼Œåªè¦æŠŠæˆ‘ä»¬çš„è¡¥ä¸soåº“çš„è·¯å¾„æ’å…¥åˆ°nativeLibraryDirectoriesæ•°ç»„çš„æœ€å‰é¢å°±èƒ½å¤Ÿè¾¾åˆ°åŠ è½½soåº“çš„æ—¶å€™æ˜¯è¡¥ä¸ åº“è€Œä¸æ˜¯åŸæ¥soåº“çš„ç›®å½•ï¼Œä»è€Œè¾¾åˆ°ä¿®å¤çš„ç›®çš„ã€‚

**sdk>=23** DexPathList.findLibrary å®ç°å¦‚ä¸‹

![å¤§äº23.jpg](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/67f7f7f2484b465c8df5125c98053a7f~tplv-k3u1fbpfcp-watermark.image?)
sdk23 ä»¥ä¸Š findLibrary å®ç°å·²ç»å‘ç”Ÿäº†å˜åŒ–ï¼Œå¦‚ä¸Šæ‰€ç¤ºï¼Œé‚£ä¹ˆæˆ‘ä»¬åªéœ€è¦æŠŠè¡¥ä¸soåº“çš„å®Œæ•´è·¯å¾„ä½œä¸ºå‚æ•°æ„å»ºä¸€ä¸ªElementå¯¹è±¡ï¼Œç„¶åå†æ’å…¥åˆ°nativeLibraryPathElements æ•°ç»„çš„æœ€å‰é¢å°±å¥½äº†ã€‚

- **ä¼˜ç‚¹**ï¼šå¯ä»¥ä¿®å¤ä¸‰æ–¹åº“çš„soåº“ã€‚åŒæ—¶æ¥å…¥æ–¹ä¸éœ€è¦åƒæ–¹æ¡ˆ1 â€”æ ·å¼ºåˆ¶ä¾µå…¥ç”¨ æˆ·æ¥å£è°ƒç”¨
- **ç¼ºç‚¹**ï¼šéœ€è¦ä¸æ–­çš„å¯¹ sdk è¿›è¡Œé€‚é…ï¼Œå¦‚ä¸Š sdk23 ä¸ºåˆ†ç•Œçº¿ï¼ŒfindLibraryæ¥å£å®ç°å·²ç»å‘ç”Ÿäº†å˜åŒ–ã€‚

å¯¹äº soåº“çš„ä¿®å¤æ–¹æ¡ˆç›®å‰æ›´å¤šé‡‡å–çš„æ˜¯æ¥å£è°ƒç”¨æ›¿æ¢æ–¹å¼ï¼Œéœ€è¦å¼ºåˆ¶ä¾µå…¥ç”¨æˆ· æ¥å£è°ƒç”¨ã€‚
ç›®å‰æˆ‘ä»¬çš„soæ–‡ä»¶ä¿®å¤æ–¹æ¡ˆé‡‡å–çš„æ˜¯åå°„æ³¨å…¥çš„æ–¹æ¡ˆï¼Œé‡å¯ç”Ÿæ•ˆã€‚å…·æœ‰æ›´å¥½çš„æ™®éæ€§ã€‚
å¦‚æœæœ‰soæ–‡ä»¶ä¿®å¤å®æ—¶ç”Ÿæ•ˆçš„éœ€æ±‚ï¼Œä¹Ÿæ˜¯å¯ä»¥åšåˆ°çš„ï¼Œåªæ˜¯æœ‰äº›é™åˆ¶æƒ…å†µã€‚

## å¸¸è§çƒ­ä¿®å¤æ¡†æ¶ï¼Ÿ

| ç‰¹æ€§       | Dexposed       | AndFix         | Tinker/Amigo | QQ Zone | Robust/Aceso | Sophix |
| ---------- | -------------- | -------------- | ------------ | ------- | ------------ | ------ |
| æŠ€æœ¯åŸç†   | nativeåº•å±‚æ›¿æ¢ | nativeåº•å±‚æ›¿æ¢ | ç±»åŠ è½½       | ç±»åŠ è½½  | Instant Run  | æ··åˆ   |
| æ‰€å±       | é˜¿é‡Œ           | é˜¿é‡Œ           | å¾®ä¿¡/é¥¿äº†ä¹ˆ  | QQç©ºé—´  | ç¾å›¢/è˜‘è‡è¡—  | é˜¿é‡Œ   |
| å³æ—¶ç”Ÿæ•ˆ   | YES            | YES            | NO           | NO      | YES          | æ··åˆ   |
| æ–¹æ³•æ›¿æ¢   | YES            | YES            | YES          | YES     | YES          | YES    |
| ç±»æ›¿æ¢     | NO             | NO             | YES          | YES     | YES          | YES    |
| ç±»ç»“æ„ä¿®æ”¹ | NO             | NO             | YES          | NO      | NO           | YES    |
| èµ„æºæ›¿æ¢   | NO             | NO             | YES          | YES     | NO           | YES    |
| soæ›¿æ¢     | NO             | NO             | YES          | NO      | NO           | YES    |
| æ”¯æŒgradle | NO             | NO             | YES          | YES     | YES          | YES    |
| æ”¯æŒART    | NO             | YES            | YES          | YES     | YES          | YES    |

**å¯ä»¥çœ‹å‡ºï¼Œé˜¿é‡Œç³»å¤šé‡‡ç”¨nativeåº•å±‚æ–¹æ¡ˆï¼Œè…¾è®¯ç³»å¤šé‡‡ç”¨ç±»åŠ è½½æœºåˆ¶ã€‚å…¶ä¸­ï¼ŒSophixæ˜¯å•†ä¸šåŒ–æ–¹æ¡ˆï¼›Tinker/Amigoæ”¯æŒç‰¹æ€§è¾ƒå¤šï¼ŒåŒæ—¶ä¹Ÿæ›´å¤æ‚ï¼Œå¦‚æœéœ€è¦ä¿®å¤èµ„æºå’Œsoï¼Œå¯ä»¥é€‰æ‹©ï¼›å¦‚æœä»…éœ€è¦æ–¹æ³•æ›¿æ¢ï¼Œä¸”éœ€è¦å³æ—¶ç”Ÿæ•ˆï¼ŒRobustæ˜¯ä¸é”™çš„é€‰æ‹©ã€‚**

## æ€»ç»“ï¼š
å°½ç®¡çƒ­ä¿®å¤ï¼ˆæˆ–çƒ­æ›´æ–°ï¼‰ç›¸å¯¹äºè¿­ä»£æ›´æ–°æœ‰è¯¸å¤šä¼˜åŠ¿ï¼Œå¸‚é¢ä¸Šä¹Ÿæœ‰å¾ˆå¤šå¼€æºæ–¹æ¡ˆå¯ä¾›é€‰æ‹©ï¼Œä½†ç›®å‰çƒ­ä¿®å¤ä¾ç„¶æ— æ³•æ›¿ä»£è¿­ä»£æ›´æ–°æ¨¡å¼ã€‚æœ‰å¦‚ä¸‹åŸå› ï¼š
çƒ­ä¿®å¤æ¡†æ¶å¤šå¤šå°‘å°‘ä¼šå¢åŠ æ€§èƒ½å¼€é”€ï¼Œæˆ–å¢åŠ APKå¤§å°
çƒ­ä¿®å¤æŠ€æœ¯æœ¬èº«å­˜åœ¨å±€é™ï¼Œæ¯”å¦‚æœ‰äº›æ–¹æ¡ˆæ— æ³•æ›¿æ¢soæˆ–èµ„æºæ–‡ä»¶
çƒ­ä¿®å¤æ–¹æ¡ˆçš„å…¼å®¹æ€§ï¼Œæœ‰äº›æ–¹æ¡ˆæ— æ³•åŒæ—¶å…¼é¡¾Dalvikå’ŒARTï¼Œæœ‰äº›æ·±åº¦å®šåˆ¶ç³»ç»Ÿä¹Ÿæ— æ³•æ­£å¸¸å·¥ä½œ
ç›‘ç®¡é£é™©ï¼Œæ¯”å¦‚è‹¹æœç³»ç»Ÿä¸¥æ ¼é™åˆ¶çƒ­ä¿®å¤

æ‰€ä»¥ï¼Œ**å¯¹äºåŠŸèƒ½è¿­ä»£å’Œå¸¸è§„bugä¿®å¤ï¼Œç‰ˆæœ¬è¿­ä»£æ›´æ–°ä¾ç„¶æ˜¯ä¸»æµã€‚ä¸€èˆ¬çš„ä»£ç ä¿®å¤ï¼Œä½¿ç”¨Robustå¯ä»¥è§£å†³ï¼Œå¦‚æœè¿˜éœ€è¦ä¿®å¤èµ„æºæˆ–soåº“ï¼Œå¯ä»¥è€ƒè™‘Tinker**ã€‚

**å‚è€ƒæ–‡ç« **
- [Tinker-æ¥å…¥æŒ‡å—](https://github.com/Tencent/tinker/wiki/Tinker-%E6%8E%A5%E5%85%A5%E6%8C%87%E5%8D%97)

- [ çƒ­ä¿®å¤åŸç†å­¦ä¹ ï¼ˆ2ï¼‰åº•å±‚æ›¿æ¢åŸç†å’Œçªç ´åº•å±‚å·®å¼‚çš„æ–¹æ³•](https://blog.csdn.net/rikkatheworld/article/details/105841838)

- [æ·±å…¥ç†è§£Androidçƒ­ä¿®å¤æŠ€æœ¯åŸç†ä¹‹soåº“çƒ­ä¿®å¤æŠ€æœ¯](https://www.jb51.net/article/216184.htm)

**`æ‰«æä¸‹æ–¹çš„å¾®ä¿¡äºŒç»´ç ï¼Œè¿™é‡Œæœ‰ä¸€å¥—å®Œæ•´çš„ç§»åŠ¨ç«¯å¼€å‘çŸ¥è¯†ä½“ç³»ï¼ŒåŠ©ä½ è¿›é˜¶é«˜çº§å¼€å‘ã€‚`**


![å…¬ä¼—å·äºŒç»´ç .jpg](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/9a407a97fa714bd58fd888d0718a587e~tplv-k3u1fbpfcp-watermark.image?)